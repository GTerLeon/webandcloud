<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TinyPet</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
<script src="https://unpkg.com/mithril/mithril.js"></script>
</head>
<body>

<script>

// Model for Petition
var Petition = {
    list: [],
    myPetitions: [],
    create: function(title, description) {
        // Create petition
    },
    loadList: function() {
        // Load petitions from the server
    },
    loadMyPetitions: function() {
        // Load user petition
    }
};

// Petition Creation View
var PetitionCreateView = {
    title: '',
    description: '',
    tags: '',
    view: function() {
        return m('div', [
        m('div',{class:'subtitle'},"Create a petition"),
        m('input[type=text][placeholder=Title]', {
            oninput: function (e) { PetitionCreateView.title = e.target.value },
            value: PetitionCreateView.title
        }),
        m('input[type=text][placeholder=Description]', {
            oninput: function (e) { PetitionCreateView.description = e.target.value },
            value: PetitionCreateView.description
        }),
        m('input[type=text][placeholder=Tags (separated by commas)]', {
            oninput: function (e) { PetitionCreateView.tags = e.target.value; },
            value: PetitionCreateView.tags
        }),
        m('button', {
            class: 'button is-link',
            onclick: function() {
                Petition.create(PetitionCreateView.title, PetitionCreateView.description);
            }
        }, 'Create petition')
        ]);
    }	
};

// My Petitions View
var MyPetitionsView = {
    list: [],
    loadMyPetitions: function() {
        // Assuming you have the user's ID and an endpoint to fetch signed petitions
        return m.request({
            method: "GET",
            url: "_ah/api/myApi/v1/userSignedPetitions/" + id_user
        })
        .then(function(result) {
            MyPetitionsView.list = result.items || [];
        })
        .catch(function(error) {
            console.error('Error loading my signed petitions:', error);
        });
    },
    oninit: function(vnode) {
        MyPetitionsView.loadMyPetitions();
    },
    view: function() {
        return m('div', [
            m('h2', 'Petitions I have signed'),
            m('div', {class: 'columns is-multiline'},
                MyPetitionsView.list.map(function(petition) {
                    return m('div', {class: 'column is-one-third'}, [
                        m('div', {class: 'box'}, [
                            m('h1', {class: 'title'}, petition.title),
                            m('p', {class: 'author'}, 'Author: ' + petition.author),
                            m('p', {class: 'description'}, petition.description),
                        ])
                    ]);
                })
            )
        ]);
    }
};

// Top Petitions View
var TopPetitionsView = {
    list: [], // This will hold the list of top petitions
    loadList: function() {
        // Make an HTTP request to your server's endpoint for the top 100 petitions
        return m.request({
            method: "GET",
            url: "_ah/api/myApi/v1/topTenPetitions" // You'll need to change this to your actual endpoint
        })
        .then(function(result) {
            TopPetitionsView.list = result.items || [];
        })
        .catch(function(error) {
            console.error('Error loading top petitions:', error);
        });
    },
    oninit: function(vnode) {
        TopPetitionsView.loadList();
    },
    view: function() {
        return m('div', [
            m('h2', 'Top 100 petitions'),
            m('div', {class: 'columns is-multiline'},
                // Loop over each petition in the list and display it
                TopPetitionsView.list.map(function(petition) {
                    return m('div', {class: 'column is-one-third'}, [
                        m('div', {class: 'box'}, [
                            m('h1', {class: 'title'}, petition.title),
                            // ... Add other petition details here
                            m('p', {class: 'signs'}, 'Signatures: ' + petition.signatureCount),
                            // Add a button or link to sign the petition
                        ])
                    ]);
                })
            )
        ]);
    }
};

var App = {
    view: function() {
        return m('div', {class: 'container'}, [
            m('nav', {class: 'level'}, [
                m('div', {class: 'level-left'}, [
                    m('h1', {class: 'title'}, 'TinyPet')
                ]),
                m('div', {class: 'level-right'}, [
                    m('a', {class: 'button is-primary', href: 'glogin-new.html'}, 'Login')
                ])
            ]),
            m('div', {class: 'title is-ancestor'}, [
                m("div", {class: 'tile'}, m('div',{class:'tile is-child box'},m(PetitionCreateView))),
                m("div", {class: 'tile'}, m('div',{class:'tile is-child box'},m(TopPetitionsView))),
                m("div", {class: 'tile'}, m('div',{class:'tile is-child box'},m(MyPetitionsView))),
            ])
        ]);
    }
};

m.mount(document.body, App);

</script>
</body>
</html>
